<!DOCTYPE HTML>
<html>
<head>
    <meta charset='UTF-8' />
    <title>Scilab via Socket.IO v0.3</title>
    <script type='text/javascript' src='/socket.io/socket.io.js'></script>
    <style type='text/css'>
    
    body {
        background-color : rgb(192,192,192);
        color : black;
        text-align : center;
    }
    
    .log {
        background-color : white;
        opacity : 1;
        width : 500px;
        height : 100px;
        margin : auto;
        text-align:left;
        border : 2px rgb(0,0,0) solid;
        overflow : auto;
        font-family: 'Lucida Console', Monaco, monospace;
        font-size:10pt;
    }
    .GO_FIGURE {
        /*
            must be relative or absolute 
            to allow absolue positioning of children
        */
        position: relative;
        background-color : white;
        width : 600px;
        height : 600px;
        margin : auto;
        border : 2px rgb(0,0,0) solid;
        overflow : auto;
        text-align: left;
    }

    .GO_PUSHBUTTON {
        position: absolute;
        left: 20px;
        top: 440px;
        width : 40px;
        height : 20px;
        text-align:center;
        overflow : hidden;
        font-family: Tahoma;
        font-size:11pt;
    }

    #infobar {
        background-color : rgb(192,192,192);
        opacity : 1;
        width : 500px;
        height : 20px;
        margin : auto;
        border : 1px rgb(0,0,0) solid;
        font-weight: bold;
    }
    
    #command {
        background-color : white;
        opacity : 1;
        width : 500px;
        height : 100px;
        margin : auto;
        border : 2px rgb(0,0,0) solid;
        overflow : auto;
        font-family: 'Lucida Console', Monaco, monospace;
        font-size:10pt;
    }

    </style>
</head>
    <body>
        <h1>Scilab WebView</h1>
        <div id='infobar'></div>
        </br>
            <textarea id='command'>
if 0 then
    f = createWindow();
    uicontrol("position", [50 50 100 40], "string", "+ 1", "callback", "v = eval(get(''num'', ''string''));set(''num'', ''string'', string(v + 1));");
    uicontrol("position", [170 50 100 40], "string", "0", "tag", "num");
    uicontrol("position", [290 50 100 40], "string", "- 1", "callback", "v = eval(get(''num'', ''string''));set(''num'', ''string'', string(v - 1));");
end

if 1 then
    f = createWindow();
    f.position(3:4) = [500, 500];
    for i=1:100
        x = floor((i-1) / 10);
        y = modulo((i-1), 10);
        uicontrol("position", [50*x, 50*y,50,50],"string", string(x) + string(y), "callback", "set(gcbo, ''string'', ''clicked'')");
    end
end
            </textarea>
            </br>
            <button id="cmdbtn" onClick="execute()">Execute</button>
        <h3>Logger:</h3>
        <div class='log' id='logger'></div>
        <script type='text/javascript'>
            var command;
            // connect to server
            var socket = io();

            resetLogger('');
            setInfo('');
            
            //callback
            function execute() {
                resetLogger();
                data = document.getElementById('command').value;
                socket.emit('command', data);
                var objCmd = document.getElementById('cmdbtn');
                objCmd.disabled  = true;
                return false;
            }
            
            //callback click
            function OnUIClick(elem) {
                var id = elem.id;
                id = parseInt(id.substring(3)); //ignore "uid"
                socket.emit("callback", {uid:id});
            }
             //tools
            function setInfo(data) {
                document.getElementById('infobar').innerHTML = data;
            }
            
           function resetLogger(data) {
                var objDiv = document.getElementById('logger');
                objDiv.innerHTML = '';
            }
            
           function setLogger(data) {
                var objDiv = document.getElementById('logger');
                objDiv.innerHTML += data + '</br>';
                objDiv.scrollTop = objDiv.scrollHeight;
            }
            
            //socket events management
            socket.on('status', function (msg) {
                setInfo(msg);
            });

            socket.on('command_end', function () {
                var objCmd = document.getElementById('cmdbtn');
                objCmd.disabled  = false;
            });

            socket.on('disconnect', function () {
                setInfo('Connection lost');
            });
            
            socket.on('graphic_create', function (msg) {
                //setLogger('<font color="green">' +  msg.data + '</font>');
                eval(msg.data);
            });
            
            socket.on('graphic_delete', function (msg) {
                //setLogger('<font color="red">' + 'graphic_delete(' + msg.uid + ')' + '</font>');
            });
            
            socket.on('graphic_update', function (msg) {
                //setLogger('<font color="orange">' +  msg.data + '</font>');
                eval(msg.data);
            });
        </script>
    </body>
</html>
