<?xml version="1.0" encoding="UTF-8"?>
<!-- Common definitions of Java compilation for Scilab --> 
<project name="common">


<!-- Base of Scilab source tree -->
  <property name="base.dir"  location="../../" />

<!-- Where the module should be created (modules/xxx/jar) -->
  <property name="build.jar.dir"  value="jar/" />

<!-- Where the thirdparty libraries could be found -->
  <property name="thirdparty.dir" location="${base.dir}/thirdparty/" />

<!-- The building directory -->
  <property name="build.dir" location="build/"/>

<!-- Where builded classes will be generated -->
  <property name="classes.dir" location="${build.dir}/classes" />

<!-- Where we store cache files -->
  <property name="cache.dir" location="${build.dir}/cachefile" />

<!-- Where we can find the sources -->
  <property name="src.dir"  location="src/java/" />

  <property name="checkstyle.config.file" value="${base.dir}/checkstyle/scilab_checkstyle_convention.xml"/>

  <property name="checkstyle.report.file" value="${build.dir}/checkstyle_errors.xml"/>

  <property name="modules.dir" value="${base.dir}/modules" />

  <property file="${base.dir}/scilab-lib.properties"/> 

<!-- Loading of the thirdparty libraries 
We could specify one by one library that we are using -->
<!--  <path id="classpath">
  	<fileset dir="${thirdparty.dir}" includes="**/*.jar"/>
  </path>
    <classpath id="compile.classpath" 
               path="${oro.jar}:${xalan.jar}" 
    /> 
-->
<path id="checkstyle.classpath">
  <pathelement location="${checkstyle.jar}"/>
</path>

<path id="compile.classpath">
  
  <pathelement location="${library.shell.dir}/${library.shell.name}"/>
  <pathelement location="${library.gui.dir}/${library.gui.name}"/>
  <pathelement location="${library.jvm.dir}/${library.jvm.name}"/>
  
  <pathelement location="${ArtTk.jar}"/>

  <pathelement location="${commons-logging.jar}"/>

  <pathelement location="${flexdock.jar}"/>

  <pathelement location="${gluegen.jar}"/>

  <pathelement location="${jyconsole.jar}"/>

  <pathelement location="${looks.jar}"/>

  <pathelement location="${jogl.jar}"/>

  <pathelement location="${jython.jar}"/>

  <pathelement location="${skinlf.jar}"/>
</path> 

  <taskdef resource="checkstyletask.properties" classpathref="checkstyle.classpath"/>

  <target name="checkstyle" description="Generates a report of code convention violations.">
	<checkstyle config="${checkstyle.config.file}">
	  <fileset dir="${src.dir}" includes="**/*.java"/>
	  <!-- Location of cache-file. -->
	  <property key="checkstyle.cache.file" file="${cache.dir}"/>
	  <formatter type="plain"/>
	  <formatter type="xml" toFile="${checkstyle.report.file}"/>
	</checkstyle> 
  </target>  
    
  <target name="init">
  	<mkdir dir="${classes.dir}"/>
	<mkdir dir="${build.jar.dir}"/>
		<!-- Create the time stamp -->
		<tstamp/>
	</target>    

<!-- Clean sources -->
  <target name="clean" description="clean sources">
  	<delete dir="${build.dir}"/>
	<delete dir="${build.jar.dir}"/>
    <delete file="${build.jar.dir}/${library.name}"/>
  </target>

<!-- Compile sources -->
  <target name="compile" description="Build sources" depends="init">
    <javac 
		srcdir="${src.dir}" 
		destdir="${classes.dir}" 
		classpathref="compile.classpath" 
		deprecation="on"
		debug="off"
		verbose="off"
		listfiles="on"
		/>
  </target>

<!-- Create the jar -->
  <target name="jar" description="Build the jar file" depends="compile">

	<jar destfile="${build.jar.dir}/${library.name}" basedir="${classes.dir}">
	  <manifest>
	  </manifest>
	</jar>
  </target>

</project>